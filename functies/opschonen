i#!/bin/bash

dir="$(dirname "$0")"

VERWIJDEREN="$dir/data/verwijderen.lijst"

# verwijder van overbodige voor geinstalleerde applicaties vermeld in 'data/overbodige.lijst'
function overbodig {
    if (eval `resize` && whiptail \
        --title "Verwijderen van overbodige voor geinstalleerde Applicaties" \
        --yesno "Huidige lijst van te verwijderen voor geinstalleerde programma's: \n\n$(cat $VERWIJDEREN) \n\nWeet u het zeker?" \
        $LINES $COLUMNS $(( $LINES - 12 )) \
        --scrolltext ) then
        show_info 'Verwijderen van overbodige voor geinstalleerde programma's...'
        show_warning 'Vereist administrator rechten'
        sudo apt-get remove -y $(cat $VERWIJDEREN)
        # Done
        show_success 'Klaar.'
        whiptail --title "Voltooid" --msgbox "Uw lijst met overbodige programma's zijn verwijderd." 8 78
        cleanup
    else
        cleanup
    fi
}

# Verwijdere oude kernels
function kernels {
    if (whiptail --title "Verwijder van overbodige kernels" --yesno "Als je niet de huidige kernel hebt geinstalleerd op je systeem, de methode kan je systeem beschadigen. \n\nWeet je het zeker om door te gaan?" 10 60) then
        show_info 'Verwijderen van oudere kernel(s)...'
        show_warning 'Vereist administrator rechten'
        sudo dpkg -l 'linux-*' | sed '/^ii/!d;/'"$(uname -r | sed "s/\(.*\)-\([^0-9]\+\)/\1/")"'/d;s/^[^ ]* [^ ]* \([^ ]*\).*/\1/;/[0-9]/!d' | grep -v linux-libc-dev | xargs sudo apt-get -y --no-install-recommends purge
        show_success 'Klaar.'
        whiptail --title "Voltooid" --msgbox "Overbodige kernels zijn succesvol verwijderd." 8 78
        cleanup
    else
        cleanup
    fi
}

# Remove Orphaned Packages
function pakket-overblijvsels {
    show_info 'Verwijderen ongebruikte pakketen...'
    show_warning 'Vereist administrator rechten'
    sudo apt-get autoremove -y
    show_success 'Klaar.'
    whiptail --title "Voltooid" --msgbox "Ongebruikte pakketen zijn succesvol verwijderd." 8 78
    cleanup
}

# Remove Leftover Config files
function overblijfsels {
    show_info 'Verwijderen van over blijvende configuratie bestanden...'
    show_warning 'Vereist administrator rechten'
    sudo dpkg --purge $(COLUMNS=200 dpkg -l | grep '^rc' | tr -s ' ' | cut -d ' ' -f 2)
    show_success 'Klaar.'
    # Check
    whiptail --title "Voltooid" --msgbox "Overblijvende configuratie bestanden zijn succesvol verwijderd." 8 78
    cleanup
}

# Clean apt cache
function schoonmaken-buffer {
    show_info 'Schoonmaken van pakket buffer...'
    show_warning 'Vereist administrator rechten'
    sudo apt-get clean
    show_success 'Klaar.'
    whiptail --title "Voltooid" --msgbox "Pakketen buffer is geleegd." 8 78
    cleanup
}

# Cleanup System
function schoonmaken {
    eval `resize` 
    CLEANUP=$(whiptail \
        --notags \
        --title "Systeem Schoonmaak" \
        --menu "\nWat wilt u gaan doen?" \
        --cancel-button "Ga terug" \
        $LINES $COLUMNS $(( $LINES - 12 )) \
        schoonmaken-buffer         'Schoonmaken van de pakket buffer' \
        pakket-overblijvsels       'Verwijderen van pakket overblijvsels' \
        ongebruikt                 'Verwijderen van ongebruikte pakketen' \
        ongebruikte                'Verwijderen van ongebruikte pakketen' \
        kernels                    'Verwijderen van oudere systeem kern(en)' \
        3>&1 1>&2 2>&3)
     
    exitstatus=$?
    if [ $exitstatus = 0 ]; then
        $CLEANUP
    else
        main
    fi
}
